var $event=$.event,$special,resizeTimeout;$special=$event.special.debouncedresize={setup:function(){$(this).on("resize",$special.handler)},teardown:function(){$(this).off("resize",$special.handler)},handler:function(i,t){var e=this,s=arguments,n=function(){i.type="debouncedresize",$event.dispatch.apply(e,s)};resizeTimeout&&clearTimeout(resizeTimeout),t?n():resizeTimeout=setTimeout(n,$special.threshold)},threshold:250};var BLANK="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";$.fn.imagesLoaded=function(i){function t(){var t=$(r),e=$(d);n&&(d.length?n.reject(h,t,e):n.resolve(h)),$.isFunction(i)&&i.call(s,h,t,e)}function e(i,e){i.src!==BLANK&&-1===$.inArray(i,o)&&(o.push(i),e?d.push(i):r.push(i),$.data(i,"imagesLoaded",{isBroken:e,src:i.src}),a&&n.notifyWith($(i),[e,h,$(r),$(d)]),h.length===o.length&&(setTimeout(t),h.unbind(".imagesLoaded")))}var s=this,n=$.isFunction($.Deferred)?$.Deferred():0,a=$.isFunction(n.notify),h=s.find("img").add(s.filter("img")),o=[],r=[],d=[];return $.isPlainObject(i)&&$.each(i,function(t,e){"callback"===t?i=e:n&&n[t](e)}),h.length?h.bind("load.imagesLoaded error.imagesLoaded",function(i){e(i.target,"error"===i.type)}).each(function(i,t){var s=t.src,n=$.data(t,"imagesLoaded");return n&&n.src===s?void e(t,n.isBroken):t.complete&&void 0!==t.naturalWidth?void e(t,0===t.naturalWidth||0===t.naturalHeight):void((t.readyState||t.complete)&&(t.src=BLANK,t.src=s))}):t(),n?n.promise(s):s};var Grid=function(){function i(i){T=$.extend(!0,{},T,i),d.imagesLoaded(function(){e(!0),a(),s()})}function t(i){l=l.add(i),i.each(function(){var i=$(this);i.data({offsetTop:i.offset().top,height:i.height()})}),n(i)}function e(i){l.each(function(){var t=$(this);t.data("offsetTop",t.offset().top),i&&t.data("height",t.height())})}function s(){n(l),u.on("debouncedresize",function(){f=0,g=-1,e(),a(),void 0!==$.data(this,"preview")&&o()})}function n(i){i.on("click","span.og-close",function(){return o(),!1}).children("a").on("click",function(i){var t=$(this).parent();return c===t.index()?o():h(t),!1})}function a(){m={width:u.width(),height:u.height()}}function h(i){var t=$.data(this,"preview"),e=i.data("offsetTop");if(f=0,void 0!==t){if(g===e)return t.update(i),!1;e>g&&(f=t.height),o()}g=e,t=$.data(this,"preview",new r(i)),t.open()}function o(){c=-1,$.data(this,"preview").close(),$.removeData(this,"preview")}function r(i){this.$item=i,this.expandedIdx=this.$item.index(),this.create(),this.update()}var d=$("#og-grid"),l=d.children("li"),c=-1,g=-1,f=0,p=10,u=$(window),m,v=$("html, body"),w={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},y=w[Modernizr.prefixed("transition")],A=Modernizr.csstransitions,T={minHeight:500,speed:350,easing:"ease"};return r.prototype={create:function(){this.$title=$('<h3 class="og-title"></h3>'),this.$description=$("<p></p>"),this.$theyear=$('<time class="og-year"></time>'),this.$thecategory=$('<span class="og-category"></span>'),this.$theduration=$('<span class="og-duration"></span>'),this.$info1=$('<div class="og-info-n1"></div>').append(this.$theyear,this.$thecategory,this.$theduration),this.$href_EN=$('<a href="#" data-lang="en" class="og-btn-play-sm">Play Video</a>'),this.$details=$('<div class="og-details"></div>').append(this.$title,this.$info1,this.$description),this.$loading=$('<div class="og-loading"></div>'),this.$fullimage=$('<div class="og-fullimg"></div>').append(this.$loading).append('<a href="" class="og-btn-play"><i class="fa fa-play" aria-hidden="true"></i></a>'),this.$closePreview=$('<span class="og-close"></span>'),this.$previewInner=$('<div class="og-expander-inner"></div>').append(this.$closePreview,this.$fullimage,this.$details),this.$previewEl=$('<div class="og-expander"></div>').append(this.$previewInner),this.$item.append(this.getEl()),A&&this.setTransition()},update:function(i){if(i&&(this.$item=i),-1!==c){l.eq(c).removeClass("og-expanded"),this.$item.addClass("og-expanded"),this.positionPreview()}c=this.$item.index();var t=this.$item.children("a"),e={href:t.attr("href"),largesrc:t.data("largesrc"),title:t.data("title"),description:t.data("description")};this.$title.html(e.title),this.$description.html(e.description),this.$thecategory.html("Comedy"),this.$theyear.html(e.year),this.$theduration=$(e.duration),this.$item.find(".og-btn-play").attr("href",e.href),this.$href_EN.attr("href",e.href);var s=this;void 0!==s.$largeImg&&s.$largeImg.remove(),s.$fullimage.is(":visible")&&(this.$loading.show(),$("<img/>").load(function(){var i=$(this);i.attr("src")===s.$item.children("a").data("largesrc")&&(s.$loading.hide(),s.$fullimage.find("img").remove(),s.$largeImg=i.fadeIn(350),s.$fullimage.append(s.$largeImg))}).attr("src",e.largesrc))},open:function(){setTimeout($.proxy(function(){this.setHeights(),this.positionPreview()},this),25)},close:function(){var i=this,t=function(){A&&$(this).off(y),i.$item.removeClass("og-expanded"),i.$previewEl.remove()};return setTimeout($.proxy(function(){void 0!==this.$largeImg&&this.$largeImg.fadeOut("fast"),this.$previewEl.css("height",0);var i=l.eq(this.expandedIdx);i.css("height",i.data("height")).on(y,t),A||t.call()},this),25),!1},calcHeight:function(){console.log(">>>this.og-fullimg=",this.$item.find(".og-fullimg").height()),console.log(">>>this.$item=",this.$item);var i=m.height-this.$item.data("height")-10,t=m.height;i<T.minHeight&&(i=T.minHeight,t=T.minHeight+this.$item.data("height")+10),this.height=i,this.itemHeight=t},setHeights:function(){var i=this,t=function(){A&&i.$item.off(y),i.$item.addClass("og-expanded")};this.calcHeight(),this.$previewEl.css("height",this.height),this.$item.css("height",this.itemHeight).on(y,t),A||t.call()},positionPreview:function(){var i=this.$item.data("offsetTop"),t=this.$previewEl.offset().top-f,e=this.height+this.$item.data("height")+10<=m.height?i:this.height<m.height?t-(m.height-this.height):t;v.animate({scrollTop:e},T.speed)},setTransition:function(){this.$previewEl.css("transition","height "+T.speed+"ms "+T.easing),this.$item.css("transition","height "+T.speed+"ms "+T.easing)},getEl:function(){return this.$previewEl}},{init:i,addItems:t}}();